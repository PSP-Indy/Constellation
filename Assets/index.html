<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Constellation Web Server</title>
    <link rel="stylesheet" href="/assets/style.css">
    <link rel="icon" href="/assets/icon.png" type="image/png">
  </head>
  <body>
    <h2>GO Grid Live Data</h2>
    <div id="grid"></div>
    <h2 id="countdown">Launch Countdown Not Initialized</h2>

    <script>
      const url = "/go-grid.txt";
      const gridEl = document.getElementById("grid");
      const countdownEl = document.getElementById("countdown");

      for (let i = 0; i < 25; i++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.innerHTML = `<div class="value">--</div><div class="label">---</div>`;
          gridEl.appendChild(cell);
      }

      function valueToColor(v) {
          v = Math.min(Math.max(v, 0), 1);
          let r, g, b = 0;

          if (v <= 0.5) {
              const t = v / 0.5;
              r = 255;
              g = Math.floor(165 * t);
          } else {
              const t = (v - 0.5) / 0.5;
              r = Math.floor(255 * (1 - t));
              g = Math.floor(165 + (90 * t));
          }
          return `rgb(${r},${g},${b})`;
      }

      async function updateGrid() {
          try {
              const resp = await fetch(url + "?t=" + Date.now());
              const text = await resp.text();

              const matches = text.match(/\(([^)]+)\)/g);
              if (!matches || matches.length < 25) return;

              matches.forEach((m, idx) => {
                  const [valueStr, label] = m.replace(/[()]/g, "").split(",");
                  const value = parseFloat(valueStr.trim());
                  const cell = gridEl.children[idx];
                  cell.querySelector(".value").textContent = value.toFixed(2);
                  cell.querySelector(".label").textContent = label.trim();
                  cell.style.backgroundColor = valueToColor(value);
              });

              const lastCommaIndex = text.lastIndexOf(",");
              let countdownStr = text.slice(lastCommaIndex + 1).trim();
              if (!countdownStr || countdownStr === "N/A") {
                  countdownEl.textContent = "Launch Countdown Not Initialized";
              } else {
                  countdownEl.textContent = `LAUNCH IN T- ${countdownStr}`;
              }

          } catch (e) {
              console.error("Fetch error:", e);
          }
      }

      updateGrid();
      setInterval(updateGrid, 1000);
    </script>
  </body>
</html>